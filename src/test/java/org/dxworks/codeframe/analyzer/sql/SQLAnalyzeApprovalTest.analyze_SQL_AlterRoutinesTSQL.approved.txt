{
  "filePath" : "src/test/resources/samples/sql/alter_routines_tsql.sql",
  "language" : "sql",
  "topLevelReferences" : { },
  "topLevelCalls" : { },
  "createProcedures" : [ {
    "procedureName" : "recalc_order_total",
    "schema" : "sales",
    "orReplace" : true,
    "parameters" : [ {
      "name" : "@orderId",
      "type" : "INT",
      "direction" : "IN"
    }, {
      "name" : "@customerId",
      "type" : "INT",
      "direction" : "IN"
    } ],
    "references" : {
      "relations" : [ "sales.order_items", "sales.orders", "sales.customer_tax_info_view" ]
    },
    "calls" : {
      "functions" : [ "fn_net_amount" ],
      "procedures" : [ "log_order_update" ]
    }
  }, {
    "procedureName" : "process_purchase_order",
    "schema" : "purchasing",
    "orReplace" : true,
    "parameters" : [ {
      "name" : "@po_id",
      "type" : "INT",
      "direction" : "IN"
    } ],
    "references" : {
      "relations" : [ "purchasing.purchase_orders", "purchasing.approved_vendors_view" ]
    },
    "calls" : {
      "functions" : [ "fn_calculate_discount" ],
      "procedures" : [ "update_expected_stock", "accounting.create_payable", "notifications.send_approval_notification" ]
    }
  } ],
  "createFunctions" : [ {
    "functionName" : "fn_net_amount",
    "orReplace" : true,
    "parameters" : [ {
      "name" : "@gross",
      "type" : "DECIMAL(12,2)",
      "direction" : "IN"
    }, {
      "name" : "@tax_rate_id",
      "type" : "INT",
      "direction" : "IN"
    } ],
    "returnType" : "DECIMAL(12,2)",
    "references" : {
      "relations" : [ "active_discounts_view", "tax_rates" ]
    },
    "calls" : { }
  }, {
    "functionName" : "fn_get_low_stock_items",
    "schema" : "inventory",
    "orReplace" : true,
    "parameters" : [ {
      "name" : "@warehouse_id",
      "type" : "INT",
      "direction" : "IN"
    } ],
    "returnType" : "TABLE",
    "references" : {
      "relations" : [ "inventory.stock", "inventory.products", "inventory.reorder_thresholds_view" ]
    },
    "calls" : { }
  } ]
}